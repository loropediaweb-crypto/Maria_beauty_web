<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>MARÍA BEAUTY</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; font-family: -apple-system, system-ui, sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }
        .tab-active { color: #db2777; border-bottom: 3px solid #db2777; }
        input { appearance: none; -webkit-appearance: none; border-radius: 1rem; }
    </style>
</head>
<body class="bg-[#fcfcfc] text-slate-900 pb-28">

    <header class="glass sticky top-0 z-50 border-b border-gray-100 p-5 pt-14">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-black tracking-tighter text-pink-600 italic uppercase">MARÍA BEAUTY</h1>
                <p id="fecha" class="text-[10px] text-gray-400 font-extrabold uppercase tracking-widest mt-1"></p>
            </div>
            <div class="text-right">
                <p class="text-[8px] text-gray-400 uppercase font-bold tracking-tighter">Valor Total</p>
                <h3 id="cap-total" class="text-sm font-black text-slate-800 tracking-tight">C$ 0</h3>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-5">
        
        <div class="mb-8">
            <input type="text" id="busqueda" onkeyup="render()" placeholder="BUSCAR PRODUCTO..." 
            class="w-full p-5 rounded-[2rem] bg-white border border-gray-50 shadow-xl shadow-gray-100/50 text-[11px] font-bold uppercase outline-none focus:ring-1 focus:ring-pink-100 transition-all">
        </div>

        <nav class="flex border-b border-gray-100 mb-8 font-black text-[11px] tracking-[0.2em] uppercase">
            <button onclick="changeTab('ventas')" id="t-ventas" class="flex-1 py-4 tab-active">Ventas</button>
            <button onclick="changeTab('inventario')" id="t-inventario" class="flex-1 py-4 text-gray-300">Inventario</button>
        </nav>

        <section id="view-ventas" class="grid grid-cols-2 gap-5"></section>

        <section id="view-inventario" class="hidden space-y-8">
            <div class="bg-white p-8 rounded-[3rem] shadow-2xl shadow-gray-100 border border-gray-50">
                <div class="space-y-4">
                    <input type="text" id="prod-n" placeholder="NOMBRE" class="w-full bg-gray-50 p-5 rounded-2xl text-[11px] font-bold outline-none border-none uppercase">
                    <div class="flex gap-3">
                        <input type="number" id="prod-p" placeholder="PRECIO" class="w-1/2 bg-gray-50 p-5 rounded-2xl text-[11px] font-black outline-none text-center border-none">
                        <input type="number" id="prod-s" placeholder="STOCK" class="w-1/2 bg-gray-50 p-5 rounded-2xl text-[11px] font-black outline-none text-center border-none">
                    </div>
                    <button onclick="addItem()" class="w-full bg-slate-900 text-white py-5 rounded-2xl text-[10px] font-black uppercase tracking-[0.3em] shadow-lg active:scale-95 transition-transform">Guardar</button>
                </div>
            </div>

            <div class="bg-white rounded-[2.5rem] shadow-xl shadow-gray-100 border border-gray-50 overflow-hidden text-center">
                <table class="w-full text-[10px]">
                    <thead class="bg-gray-50 text-gray-400 uppercase font-black">
                        <tr><th class="p-5 text-left uppercase">Lista</th><th class="p-5">Stock</th><th class="p-5"></th></tr>
                    </thead>
                    <tbody id="lista-inv" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>

            <button onclick="exportar()" class="w-full py-5 text-gray-400 font-bold text-[9px] uppercase tracking-[0.4em] border-2 border-dashed border-gray-100 rounded-3xl active:bg-gray-50 transition-colors">
                Reporte Total Excel
            </button>
        </section>
    </main>

    <script>
        let db = JSON.parse(localStorage.getItem('mb_final_fixed')) || [];

        function changeTab(t) {
            document.getElementById('view-ventas').classList.toggle('hidden', t !== 'ventas');
            document.getElementById('view-inventario').classList.toggle('hidden', t !== 'inventario');
            document.getElementById('t-ventas').className = t === 'ventas' ? 'flex-1 py-4 tab-active' : 'flex-1 py-4 text-gray-300';
            document.getElementById('t-inventario').className = t === 'inventario' ? 'flex-1 py-4 tab-active' : 'flex-1 py-4 text-gray-300';
            render();
        }

        function addItem() {
            const n = document.getElementById('prod-n').value;
            const p = document.getElementById('prod-p').value;
            const s = document.getElementById('prod-s').value;
            if(n && p && s) {
                db.push({ id: Date.now(), n: n.toUpperCase(), p: parseFloat(p), s: parseInt(s) });
                save();
                document.querySelectorAll('input').forEach(i => i.value = '');
            }
        }

        function sell(id) {
            const item = db.find(x => x.id === id);
            if(item && item.s > 0) {
                item.s--;
                save();
            } else { alert("STOCK AGOTADO"); }
        }

        function remove(id) {
            if(confirm('¿ELIMINAR PRODUCTO?')) {
                db = db.filter(x => x.id !== id);
                save();
            }
        }

        function save() {
            localStorage.setItem('mb_final_fixed', JSON.stringify(db));
            render();
        }

        function exportar() {
            let csv = "PRODUCTO,PRECIO,STOCK,TOTAL_C$\n";
            db.forEach(i => csv += `${i.n},${i.p},${i.s},${i.p*i.s}\n`);
            const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            const hoy = new Date().toLocaleDateString('es-NI').replace(/\//g, '-');
            a.href = url; a.download = `Reporte_Total_Maria_${hoy}.csv`; a.click();
        }

        function render() {
            const grid = document.getElementById('view-ventas');
            const lista = document.getElementById('lista-inv');
            const busq = document.getElementById('busqueda').value.toUpperCase();
            let totalGeneral = 0;
            
            grid.innerHTML = ''; lista.innerHTML = '';
            const filtrados = db.filter(x => x.n.includes(busq));

            filtrados.forEach(x => {
                totalGeneral += (x.p * x.s);
                grid.innerHTML += `
                    <div class="bg-white p-6 rounded-[3rem] border border-gray-50 flex flex-col items-center shadow-xl shadow-gray-100/30 active:scale-95 transition-transform">
                        <h4 class="text-[10px] font-black text-gray-400 uppercase truncate w-full text-center tracking-tighter">${x.n}</h4>
                        <p class="text-xl font-black my-3 tracking-tighter italic">C$ ${x.p}</p>
                        <p class="text-[10px] mb-5 font-bold ${x.s < 3 ? 'text-red-500 font-black' : 'text-gray-300'} uppercase italic">Stock: ${x.s}</p>
                        <button onclick="sell(${x.id})" class="w-full bg-slate-900 text-white py-4 rounded-[1.5rem] text-[10px] font-black uppercase tracking-widest active:bg-pink-600 shadow-md transition-all">Vendido</button>
                    </div>`;

                lista.innerHTML += `
                    <tr class="text-[10px] font-bold border-b border-gray-50">
                        <td class="p-5 text-slate-700 uppercase text-left">${x.n}</td>
                        <td class="p-5 text-center font-black ${x.s < 3 ? 'text-red-500' : ''}">${x.s}</td>
                        <td class="p-5 text-right"><button onclick="remove(${x.id})" class="text-gray-200 uppercase text-[8px]">Borrar</button></td>
                    </tr>`;
            });
            document.getElementById('cap-total').innerText = `C$ ${totalGeneral.toLocaleString()}`;
        }

        document.getElementById('fecha').innerText = new Date().toLocaleDateString('es-NI', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        render();
    </script>
</body>
</html>
